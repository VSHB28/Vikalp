@model Vikalp.Models.DTO.SubCentreDto

@{
    var title = Model.SubCentreId > 0 ? "Edit Sub Centre" : "Add Sub Centre";
    ViewData["Title"] = title;
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container py-2">
    <div class="card">
        <div class="card-body">
            <div class="umcard-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">@title</h3>
                    <a href="/SubCentre/Index" class="btn btn-secondary">← Back to List</a>
                </div>
            </div>

            <form asp-action="@(Model.SubCentreId > 0 ? "Edit" : "Create")"
                  method="post"
                  class="row g-3">

                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="SubCentreId" />

                <!-- STATE -->
                <div class="col-md-3">
                    <label class="form-label">State</label>
                    <select name="RegionId" id="stateDropdown" class="form-control" required>
                        <option value="">Select State</option>
                        @foreach (var s in ViewBag.States)
                        {
                            <option value="@s.Id" @(Model.RegionId == s.Id ? "selected" : "")>
                                @s.Name
                            </option>
                        }
                    </select>
                </div>

                <!-- DISTRICT -->
                <div class="col-md-3">
                    <label class="form-label">District</label>
                    <select name="DistrictId" id="districtDropdown" class="form-control" required>
                        <option value="">Select District</option>
                        @if (ViewBag.Districts != null)
                        {
                            foreach (var d in ViewBag.Districts)
                            {
                                <option value="@d.Id" @(Model.RegionId == d.Id ? "selected" : "")>
                                    @d.Name
                                </option>
                            }
                        }
                    </select>
                </div>

                <!-- BLOCK -->
                <div class="col-md-3">
                    <label class="form-label">Block</label>
                    <select name="BlockId" id="blockDropdown" class="form-control" required>
                        <option value="">Select Block</option>
                        @if (ViewBag.Blocks != null)
                        {
                            foreach (var b in ViewBag.Blocks)
                            {
                                <option value="@b.Id" @(Model.BlockId == b.Id ? "selected" : "")>
                                    @b.Name
                                </option>
                            }
                        }
                    </select>
                </div>

                <!-- FACILITY -->
                @*     <div class="col-md-3">
                    <label class="form-label">Facility</label>
                    <input name="FacilityId"
                           class="form-control"
                           value="@Model.FacilityId" />
                </div> *@

                <div class="col-md-3">
                    <label class="form-label">Facility</label>
                    <select name="FacilityId" id="facilityDropdown" class="form-control" required>
                        <option value="">Select Facility</option>
                    </select>
                </div>




                <!-- SUBCENTRE NAME -->
                <div class="col-md-3">
                    <label class="form-label">Sub Centre Name</label>
                    <input name="SubCentre"
                           class="form-control"
                           value="@Model.SubCentre"
                           required />
                </div>

                <div class="col-md-3">
                    <label class="form-label">NIN Number</label>
                    <input name="NinNumber"
                           class="form-control"
                           value="@Model.NinNumber"
                           maxlength="12"
                           required
                           oninput="this.value = this.value.replace(/[^0-9]/g, '')" />
                </div>





                <!-- ANM -->
                <div class="col-md-3">
                    <label class="form-label">ANM Id</label>
                    <input name="AnmId"
                           class="form-control"
                           value="@Model.AnmId" />
                </div>

                <!-- STATUS -->
                <div class="col-md-3">
                    <label class="form-label d-block">Status</label>

                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="IsActive"
                               value="true"
                               @(Model.IsActive ? "checked" : "") />
                        <label class="form-check-label">Active</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="IsLearningSite"
                               value="true"
                               @(Model.IsLearningSite ? "checked" : "") />
                        <label class="form-check-label">Learning Site</label>
                    </div>
                </div>

                <div class="col-12">
                    <button type="submit" class="btn btn-save">
                        @(Model.SubCentreId > 0 ? "Update" : "Create")
                    </button>
                    <a href="/SubCentre/Index" class="btn btn-back ms-2">Cancel</a>
                </div>

            </form>

        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(function () {

        // STATE CHANGE
        $('#stateDropdown').change(function () {
            var stateId = $(this).val();
            $('#districtDropdown').html('<option value="">Select District</option>');
            $('#blockDropdown').html('<option value="">Select Block</option>');

            if (!stateId) return;

            $.getJSON('/SubCentre/GetDistricts', { stateId: stateId }, function (data) {
                $.each(data, function (i, d) {
                    var selected = d.id == '@Model.DistrictId' ? 'selected' : '';
                    $('#districtDropdown').append(`<option value="${d.id}" ${selected}>${d.name}</option>`);
                });
                $('#districtDropdown').change();
            });
        });

        // DISTRICT CHANGE
        $('#districtDropdown').change(function () {
            var districtId = $(this).val();
            $('#blockDropdown').html('<option value="">Select Block</option>');

            if (!districtId) return;

            $.getJSON('/SubCentre/GetBlocks', { districtId: districtId }, function (data) {
                $.each(data, function (i, b) {
                    var selected = b.id == '@Model.BlockId' ? 'selected' : '';
                    $('#blockDropdown').append(`<option value="${b.id}" ${selected}>${b.name}</option>`);
                });
            });
        });

        if ($('#stateDropdown').val() != '') $('#stateDropdown').change();

    });

        // BLOCK CHANGE → load facilities
    $('#blockDropdown').change(function () {
        var blockId = $(this).val();
        $('#facilityDropdown').html('<option value="">Select Facility</option>');

        if (!blockId) return;

        $.getJSON('/SubCentre/GetFacilities', { blockId: blockId }, function (data) {
            $.each(data, function (i, f) {
                var selected = f.id == '@Model.FacilityId' ? 'selected' : '';
                $('#facilityDropdown').append(`<option value="${f.id}" ${selected}>${f.name}</option>`);
            });
        });
    });





</script>