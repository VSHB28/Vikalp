@model Vikalp.Models.DTO.FacilityDto

@{
    var title = Model.FacilityId > 0 ? "Edit Facility" : "Add Facility";
    ViewData["Title"] = title;
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container py-4">
    <div class="card">
        <div class="card-body">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">@title</h3>
                <a href="/Facility/Index" class="btn btn-secondary">← Back to List</a>
            </div>

            <form asp-action="@(Model.FacilityId > 0 ? "Edit" : "Create")"
                  method="post"
                  class="row g-3">

                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="FacilityId" />

                <!-- STATE -->
                <div class="col-md-3">
                    <label class="form-label">State</label>
                    <select name="RegionId" id="stateDropdown" class="form-control" required>
                        <option value="">Select State</option>
                        @foreach (var s in ViewBag.States)
                        {
                            <option value="@s.Id" @(Model.RegionId == s.Id ? "selected" : "")>
                                @s.Name
                            </option>
                        }
                    </select>
                </div>

                <!-- DISTRICT -->
                <div class="col-md-3">
                    <label class="form-label">District</label>
                    <select name="DistrictId" id="districtDropdown" class="form-control" required>
                        <option value="">Select District</option>
                        @if (ViewBag.Districts != null)
                        {
                            foreach (var d in ViewBag.Districts)
                            {
                                <option value="@d.Id" @(Model.DistrictId == d.Id ? "selected" : "")>
                                    @d.Name
                                </option>
                            }
                        }
                    </select>
                </div>

                <!-- BLOCK -->
                <div class="col-md-3">
                    <label class="form-label">Block</label>
                    <select name="BlockId" id="blockDropdown" class="form-control" required>
                        <option value="">Select Block</option>
                        @if (ViewBag.Blocks != null)
                        {
                            foreach (var b in ViewBag.Blocks)
                            {
                                <option value="@b.Id" @(Model.BlockId == b.Id ? "selected" : "")>
                                    @b.Name
                                </option>
                            }
                        }
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Facility Name</label>
                    <input name="FacilityName"
                           class="form-control"
                           value="@Model.FacilityName"
                           required />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Facility Type</label>
                    <select name="FacilityType" class="form-control">
                    <option value="">-- Select Facility Type --</option>

                    @foreach (Vikalp.Models.DTO.DropdownDto item
                                        in (List<Vikalp.Models.DTO.DropdownDto>)ViewBag.FacilityTypes)
                    {
                        <option value="@item.Id">@item.Name</option>
                    }
                </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">NIN Number</label>
                    <input name="NinNumber"
                           class="form-control"
                           value="@Model.NinNumber" />
                </div>

               
                <div class="col-md-3">
                    <label class="form-label d-block">Status</label>

             
                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="IsActive"
                               value="true"
                               @(Model.IsActive ? "checked" : "") />
                        <label class="form-check-label">Active</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="IsIntervention"
                               value="true"
                               @(Model.IsIntervention ? "checked" : "") />
                        <label class="form-check-label">Intervention</label>
                    </div>


                </div>

                <div class="col-12">
                    <button type="submit" class="btn btn-save btn-primary">
                        @(Model.FacilityId > 0 ? "Update" : "Create")
                    </button>
                    <a href="/Facility/Index" class="btn btn-secondary ms-2">Cancel</a>
                </div>

            </form>

        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function () {

        
        $('#stateDropdown').change(function () {
            var stateId = $(this).val();
            $('#districtDropdown').html('<option value="">Select District</option>');
            $('#blockDropdown').html('<option value="">Select Block</option>');

            if (!stateId) return;

            $.getJSON('/Facility/GetDistricts', { stateId: stateId }, function (data) {
                $.each(data, function (i, d) {
                    var selected = d.id == '@Model.DistrictId' ? 'selected' : '';
                    $('#districtDropdown').append(`<option value="${d.id}" ${selected}>${d.name}</option>`);
                });
                $('#districtDropdown').change(); 
            });
        });

     
        $('#districtDropdown').change(function () {
            var districtId = $(this).val();
            $('#blockDropdown').html('<option value="">Select Block</option>');

            if (!districtId) return;

            $.getJSON('/Facility/GetBlocks', { districtId: districtId }, function (data) {
                $.each(data, function (i, b) {
                    var selected = b.id == '@Model.BlockId' ? 'selected' : '';
                    $('#blockDropdown').append(`<option value="${b.id}" ${selected}>${b.name}</option>`);
                });
            });
        });

      
        if ($('#stateDropdown').val() != '') $('#stateDropdown').change();

    });
</script>
